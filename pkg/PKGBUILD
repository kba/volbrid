# Maintainer: Konstantin Baierer <konstantin.baierer@gmail.com>
pkgname=volbrid-git # '-bzr', '-git', '-hg' or '-svn'
pkgver=v0.2.0.r3.d5d07a3
pkgrel=2
pkgdesc="Volume and brightness notification"
arch=('any')
url="http://github.com/kba/volbrid"
license=('MIT')
groups=()
depends=('nodejs>=0.11' 'socat>=1.7')
optdepends=('xorg-xbacklight: backlight support'
            'pulseaudio: pulseaudio volume support'
            'acpi: battery support'
            'libnotify: send notifications'
            'yad: simple notification'
            'zenity: simple notification'
            'volnoti: Mac OSX style notification'
            )
makedepends=('git' 'npm>=3' 'coffee-script>=1.10')
provides=("${pkgname%-git}")
conflicts=("${pkgname%-git}")
replaces=()
backup=('etc/volbrid.yaml')
options=()
install=
source=('volbrid::git+https://github.com/kba/volbrid')
noextract=()
md5sums=('SKIP')

pkgver() {
	cd "$srcdir/${pkgname%-git}"
    printf "%s" "$(git describe --long | sed 's/\([^-]*-\)g/r\1/;s/-/./g')"
}

package() {
	cd "$srcdir/${pkgname%-git}"

	# Install
    npm install --global --unsafe-perm --prefix "$pkgdir"/usr

    # Strip references to $srcdir and $pkgdir
    find $pkgdir -name "package.json" -exec sed -i "s,$srcdir/${pkgname%-git},," {} \;
    find $pkgdir -name "package.json" -exec sed -i "s,$pkgdir,," {} \;

    # Link license
    mkdir -p "$pkgdir/usr/share/licenses/$pkgname"
    ln -s "../../../lib/node_modules/$pkgname/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/"
}
